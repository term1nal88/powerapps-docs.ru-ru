---
title: Пошаговое руководство по использованию виртуальной сущности с поставщиком данных OData в Common Data Service for Apps | Документы Майкрософт
description: Сведения об использовании поставщика данных OData версии 4 с виртуальной сущностью
ms.custom: ''
ms.date: 06/04/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
ms.assetid: ''
caps.latest.revision: 11
author: Mattp123
ms.author: matp
manager: kvivek
ms.openlocfilehash: ebdd8f80aad2d353d017626b7c403da93803c19b
ms.sourcegitcommit: aba996b1773ecdf62758e06b34eaf57bede29e08
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/08/2018
ms.locfileid: "39699688"
---
# <a name="virtual-entity-walkthrough-using-the-odata-v4-data-provider"></a>Пошаговое руководство по использованию виртуальной сущности с поставщиком данных OData версии 4

Представьте себе, что вы хотите получить доступ к сведениям о билете из внешнего источника данных в рамках приложения на основе модели или области обслуживания Dynamics 365 for Customer Engagement. В этом пошаговом руководстве моделируется виртуальная сущность с полями, сопоставленными с внешней схемой, которая извлекает данные билета во время выполнения из веб-службы OData.

## <a name="data-source-details"></a>Сведения об источнике данных

Так как источник данных, используемый в этом пошаговом руководстве, имеет веб-службу OData версии 4, мы можем использовать поставщик данных OData версии 4, включенный в вашу среду.

URL-адрес веб-службы: `http://contosowebservice.azurewebsites.net/odata/` 

> [!IMPORTANT]
> URL-адрес веб-службы, используемый в этом пошаговом руководстве, не указывает на работающую веб-службу.

В рамках этого руководства требуется отдельная виртуальная сущность с тремя указанными ниже полями.

|Имя внешнего поля |Тип внешних данных |Тип данных виртуальной сущности |Цель |
|---------|---------|---------|---------|
|TicketID |`Edm.Guid` |Первичный ключ |Первичный ключ для сущности |
|Title  |`Edm.String` |Однострочный текст |Заголовок билета |
|Серьезность |`Edm.Int32`| целое число; |Числовое значение от 0 до 4, указывающее важность билета |

Метаданные OData для сущности Ticket внешнего источника данных:

```xml
<EntityType Name="Ticket">
  <Key>
    <PropertyRef Name="TicketID" />
  </Key>
  <Property Name="TicketID" Nullable="false" Type="Edm.Guid" />
  <Property Name="Title" Type="Edm.String" />
  <Property Name="Severity" Nullable="false" Type="Edm.Int32" />
</EntityType>
```

## <a name="create-the-data-source"></a>Создание источника данных

Создайте источник данных для поставщика данных OData версии 4, который использует образец веб-службы OASIS Open Data Protocol (OData).

1. Перейдите в раздел **Параметры** > **Администрирование** > **Источники данных виртуальных сущностей**.
1. Выберите **Создать**, **Поставщик данных OData версии 4** и нажмите кнопку **ОК**.
1. Укажите или выберите указанную ниже информацию.

    |Поле|Значение|
    |--|--|
    |**Name** (Наименование)|Источник демонстрационных данных Contoso|
    |**URL-адрес**|`http://contosowebservice.azurewebsites.net/odata` |
    |**Время ожидания**|30|
    |**Return Inline Count** (Возврат встроенного счетчика)|True|

Оставьте в остальных полях значения по умолчанию и выберите **Сохранить и закрыть**.

> [!TIP]
> При использовании собственной веб-службы проверьте допустимость URL-адреса, вставив его в веб-браузер. 

## <a name="open-solution-explorer"></a>Открытие обозревателя решений

Часть имени любой пользовательской сущности, которую вы создаете, является настраиваемым префиксом. Он устанавливается на основе издателя решений для того решения, в котором вы работаете. Если вам нужен настраиваемый префикс, убедитесь, что вы работаете в неуправляемом решении, где настраиваемый префикс — это префикс, который необходим для этой сущности. Дополнительные сведения: [Изменение префикса издателя решений](change-solution-publisher-prefix.md) 

[!INCLUDE [cc_navigate-solution-from-powerapps-portal](../../includes/cc_navigate-solution-from-powerapps-portal.md)]


## <a name="create-the-virtual-entity"></a>Создание виртуальной сущности

1. В левой области навигации обозревателя решений выберите **Сущности**, а затем выберите **Создать** в основной области.
2. В форме **Сущность: новая** выберите параметр **Виртуальная сущность**, а затем введите следующие сведения: 

    |Поле|Значение|
    |--|--|
    |**Источник данных**|Источник демонстрационных данных Contoso|
    |**Отображаемое имя**|Билет|
    |**Имя во множественном числе**|Билеты|
    |**Name** (Наименование)|new_ticket|
    |**Внешнее имя**|Билет|
    |**Имя внешней коллекции**|Билеты|
    |**Примечания (включают в себя вложения)**|выбрано|
    |**Действия**|выбрано|

1. Рядом с полем **Области для отображения сущности** выберите **Служба**, а затем выберите **Сохранить** (но не закрывайте форму сущности).
    ![Определение сущности Ticket](media/ticket-entity.png)

## <a name="create-the-fields-for-the-virtual-entity"></a>Создание полей для виртуальной сущности

В левой области навигации на странице **Сущность: билет** выберите **Поля**. В рамках этого пошагового руководства вы измените два существующих поля и добавите третье.

> [!IMPORTANT]
> Внешние имена определяются с учетом регистра. Сверьтесь с метаданными веб-службы, чтобы убедиться, что используется правильное имя.
> Значение false, допускающее значение NULL, означает, что атрибут является обязательным. Обратите внимание на то, что поля первичного ключа всегда являются обязательными для системы.

1. Откройте поле **new_ticketid** и измените следующий атрибут на указанное здесь значение: **Внешнее имя**: TicketID ![Поле TicketID](media/ticketid-field.png)
1. Нажмите **Сохранить и закрыть**.
1. Откройте поле **new_name** и измените следующие атрибуты, задав указанные здесь значения:
    - **Отображаемое имя**: Title
    - **Внешнее имя**: Title ![Поле Title](media/title-field.png)
1. Нажмите **Сохранить и закрыть**.
1. Выберите **Создать**, а затем на странице **Поле: новое для билета** введите следующие сведения:

    |Поле|Значение|
    |--|--|
    |**Отображаемое имя**|Серьезность|
    |**Name** (Наименование)|new_severity|
    |**Внешнее имя**|Серьезность|
    |**Требование поля	**|Бизнес-требование|
    |**Тип данных**|целое число;|
    |**Минимальное значение**|0|
    |**Максимальное значение**|4|

  ![Поле важности](media/severity-field.png)
1. Нажмите **Сохранить и закрыть**.

## <a name="add-the-fields-to-the-main-form"></a>Добавьте поля в главную форму

1. В окне сущности Ticket выберите **Формы**.
1. Откройте главную форму, перетащите поле **Важность** из области справа на форму в раздел **Общие** под полем **Заголовок**. 
    ![Поле важности, добавленное на главную форму](media/drop-severity-field.png)
1. В окне сущности Ticket выберите **Сохранить и закрыть**.

## <a name="configure-the-default-view"></a>Настройка представления по умолчанию

1. На левой панели обозревателя решений в разделе **Сущность Ticket** выберите **Представления**.
1. Откройте представление **Все билеты**.
1. В области **Общие задачи** выберите **Добавить столбцы**.
    ![Добавление столбцов для представления](media/addcolumns.png)
1. Выберите **Важность** и нажмите кнопку **ОК**.
1. В окне **Представление: все билеты** выберите **Сохранить и закрыть**.
1. В окне обозревателя решений выберите команду **Опубликовать все настройки**.
    ![Публикация всех настроек](media/publishall.png)
1. После публикации всех настроек закройте окно обозревателя решений.

## <a name="view-the-virtual-entity-in-action-with-dynamics-365-customer-engagement"></a>Просмотр виртуальной сущности в действии с помощью Dynamics 365 Customer Engagement

1. Выберите **Служба** > **Расширения** > **Билеты**.
    
    ![Область билета](media/ticket-area.png)

    Отображается представление **Все билеты**. Обратите внимание, что может потребоваться обновить страницу в браузере, чтобы просмотреть сущность из области **Служба**.

    ![Представление "Все билеты"](media/all-tickets-view.png)
1. Откройте запись **Билет**, чтобы просмотреть форму, включающую поля **Заголовок** и **Важность** для данной записи.
    ![Запись билета](media/ticket-record.png)

### <a name="see-also"></a>См. также

[Конфигурация, требования и рекомендации для поставщика данных OData версии 4](virtual-entity-odata-provider-requirements.md)<br />
[Создание и изменение виртуальных сущностей, содержащих данные из внешнего источника данных](create-edit-virtual-entities.md)
