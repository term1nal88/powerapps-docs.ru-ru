---
title: Пошаговое руководство по виртуальным сущностям с использованием поставщика данных виртуальной сущности OData v4 в Common Data Service для приложений | MicrosoftDocs
description: 'Узнайте, как использовать поставщика данных OData v4 с виртуальной сущностью'
ms.custom: ''
ms.date: 06/04/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
  - Dynamics 365 (online)
  - Dynamics 365 Version 9.x
  - powerapps
ms.assetid: null
caps.latest.revision: 11
author: Mattp123
ms.author: matp
manager: kvivek
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---

# <a name="virtual-entity-walkthrough-using-the-odata-v4-data-provider"></a>Пошаговое руководство по созданию виртуальной сущности с использованием поставщика данных OData v4

Представьте, что вам требуется доступ к информации о билетах из внешнего источника данных в рамках приложения, управляемого моделью, или области обслуживания Dynamics 365 for Customer Engagement. В этом простом пошаговом руководстве вы моделируете виртуальную сущность с полями, составленными внешней схеме, которая извлекает данные о билетах на время выполнения из веб-службы OData.

## <a name="data-source-details"></a>Сведения об источнике данных

Поскольку источник данных, используемый для данного пошагового руководства, имеет веб-службу OData v4, мы можем использовать поставщик данных OData v4, имеющийся в вашей среде.

URL-адрес веб-службы: `http://contosowebservice.azurewebsites.net/odata/` 

> [!IMPORTANT]
> URL-адрес веб-службы, используемый для этого пошагового руководства, не является действующей веб-службой.

Для этого пошагового руководства требуется одна виртуальная сущность, содержащая следующие три поля.

|Имя внешнего поля |Тип внешних данных |Тип данных виртуальной сущности |Назначение |
|---------|---------|---------|---------|
|TicketID |`Edm.Guid` |Первичный ключ |Первичный ключ для сущности |
|Заголовок  |`Edm.String` |Строка текста |Название билета |
|Важность |`Edm.Int32`| Целое число |Числовое значение от 0 до 4, представляющее важность билета |

Метаданные OData сущности билета внешнего источника данных:

```xml
<EntityType Name="Ticket">
  <Key>
    <PropertyRef Name="TicketID" />
  </Key>
  <Property Name="TicketID" Nullable="false" Type="Edm.Guid" />
  <Property Name="Title" Type="Edm.String" />
  <Property Name="Severity" Nullable="false" Type="Edm.Int32" />
</EntityType>
```

## <a name="create-the-data-source"></a>Создание источника данных

Создайте источник данных для поставщика данных OData v4, который использует пример веб-службы с открытым протоколом OASIS Open Data Protocol (OData).

1. Перейдите в раздел **Параметры** > **Администрирование** > **Источники данных виртуальных сущностей**.
1. Выберите **СОЗДАТЬ**, выберите **Поставщик данных OData v4**, затем выберите **ОК**.
1. Введите или выберите следующие сведения.

    |Поле|Значение|
    |--|--|
    |**Название**|Пример источника данных Contoso|
    |**URL-адрес**|`http://contosowebservice.azurewebsites.net/odata` |
    |**Время ожидания**|30|
    |**Вернуть количество в строке**|Истина|

Оставьте другие поля без изменений и выберите **СОХРАНИТЬ И ЗАКРЫТЬ**.

> [!TIP]
> При использовании вашей собственной веб-службы проверьте правильность URL-адреса, вставив его в веб-браузер. 

## <a name="open-solution-explorer"></a>Откройте обозреватель решений

Часть имени любой создаваемой настраиваемой сущности — это префикс настройки. Это настраивается с использованием издателя решений для решения, в котором выполняется работа. Если важен префикс настройки, убедитесь, что вы работаете с неуправляемым решением, префикс настройки в котором — тот, который нужен для данной сущности. Дополнительные сведения: [Изменение префикса издателя решения](change-solution-publisher-prefix.md) 

[!INCLUDE [cc_navigate-solution-from-powerapps-portal](../../includes/cc_navigate-solution-from-powerapps-portal.md)]


## <a name="create-the-virtual-entity"></a>Создание виртуальной сущности

1. В левой области навигации обозревателя решений выберите **Сущности**, затем выберите **Создать** в основной области.
2. В форме **Сущность: новая** выберите вариант **Виртуальная сущность**, затем введите следующие сведения: 

    |Поле|Значение|
    |--|--|
    |**Источник данных**|Пример источника данных Contoso|
    |**Отображаемое имя**|Билет|
    |**Имя во множественном числе**|Билеты|
    |**Название**|new_ticket|
    |**Внешнее имя**|Билет|
    |**Имя внешней коллекции**|Билеты|
    |**Примечания (включают в себя вложения)**|выбранную|
    |**Действия**|выбранную|

1. Рядом с пунктом **Области для отображения сущности** выберите **Служба**, затем выберите **Сохранить** (но не закрывайте форму сущности).
    ![Определение сущности "Билет"](media/ticket-entity.png)

## <a name="create-the-fields-for-the-virtual-entity"></a>Создание полей для виртуальной сущности

В левой области навигации на странице **Сущность: Билет** выберите **Поля**. В данном пошаговом руководстве вы измените два существующих поля и добавите третье поле.

> [!IMPORTANT]
> Внешние имена чувствительны к регистру символов. См. в метаданных веб-службы, чтобы убедиться, что используется правильное имя.
> Значение "Нет" для "Допускает значение NULL" означает, что атрибут является обязательным. Обратите внимание, что поля первичного ключа всегда обязательны для системы.

1. Откройте поле **new_ticketid** и измените следующий атрибут на указанное здесь значение: **Внешнее имя**: TicketID  ![Поле TicketID](media/ticketid-field.png)
1. Выберите **Сохранить и закрыть**.
1. Откройте поле **new_name** и измените следующие атрибуты на указанные здесь значения:
    - **Отображаемое имя**: Заголовок
    - **Внешнее имя**: Заголовок ![Поле заголовка](media/title-field.png)
1. Выберите **Сохранить и закрыть**.
1. Выберите **Создать**, затем на странице **Поле: создать для Билет** введите следующую информацию:

    |Поле|Значение|
    |--|--|
    |**Отображаемое имя**|Важность|
    |**Название**|new_severity|
    |**Внешнее имя**|Важность|
    |**Требование поля**|Бизнес-требование|
    |**Тип данных**|Целое число|
    |**Минимальное значение**|0|
    |**Максимальное значение**|4|

  ![Поле "Важность"](media/severity-field.png)
1. Выберите **Сохранить и закрыть**.

## <a name="add-the-fields-to-the-main-form"></a>Добавление полей в главную форму

1. В диалоговом окне сущности "Билет" выберите **Формы**.
1. Откройте основную форму, перетащите поле **Важность** из правой области на форму в раздел **Общие сведения** в поле **Заголовок**. 
    ![Поле "Важность", добавленное в главную форму](media/drop-severity-field.png)
1. В диалоговом окне сущности "Билет" выберите **Сохранить и закрыть**.

## <a name="configure-the-default-view"></a>Настройка представления по умолчанию

1. В левой области обозревателя решений под узлом **Сущность "Билет"** выберите **Представления**.
1. Откройте представление **Все билеты**.
1. В области **Общие задачи** выберите **Добавить столбцы**.
    ![Добавление столбцов для представления](media/addcolumns.png)
1. Выберите **Важность**, затем выберите **ОК**.
1. В окне **Представление: Все билеты** выберите **Сохранить и закрыть**.
1. В окне обозревателя решений выберите **Опубликовать все настройки**.
    ![Опубликовать все настройки](media/publishall.png)
1. После публикации всех настроек закройте окно обозревателя решений.

## <a name="view-the-virtual-entity-in-action-with-dynamics-365-customer-engagement"></a>Просмотр виртуальной сущности в действии с Dynamics 365 Customer Engagement

1. Откройте **Служба** > **Расширения** > **Билеты**.
    
    ![Область билетов](media/ticket-area.png)

    Открывается представление **Все билеты**. Обратите внимание, что, возможно, потребуется обновить браузер, чтобы можно было просмотреть сущность из области **Служба**.

    ![Представление "Все билеты"](media/all-tickets-view.png)
1. Откройте запись **Билет** для просмотра формы, содержащей поля **Заголовок** и **Важность** для определенной записи.
    ![Запись билета](media/ticket-record.png)

### <a name="see-also"></a>См. также

[Конфигурация, требования и рекомендации для поставщика данных OData v4](virtual-entity-odata-provider-requirements.md)<br />
[Создание и изменение виртуальных сущностей, содержащих данные из внешнего источника данных](create-edit-virtual-entities.md)
