---
title: Запрос и визуализация иерархических данных с PowerApps | MicrosoftDocs
description: 'Узнайте, как запрашивать и визуально отображать иерархически связанные данные'
ms.custom: ''
ms.date: 06/20/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
  - Dynamics 365 (online)
  - Dynamics 365 Version 9.x
  - powerapps
author: Mattp123
ms.assetid: 0cf62817-5ff5-40bb-ad17-e1f6b0921720
caps.latest.revision: 42
ms.author: matp
manager: kvivek
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---
# <a name="query-and-visualize-hierarchically-related-data"></a>Запрос и визуализация иерархически связанных данных

Пользователь может получить ценную аналитическую информацию, визуализировав иерархически связанные данные. Функции иерархического моделирования и визуализации предоставляют несколько преимуществ:  
  
-   Просмотр и изучение сложной иерархической информации.  
  
-   Просмотр ключевых показателей эффективности в контекстуальном представлении иерархии.  
  
-   Визуальный анализ ключевой информации при работе с веб-сайтом и планшетами.  
  
Для некоторых сущностей, таких как организации или пользователь, доступны готовые визуализации. Для других сущностей, включая настраиваемые сущности, можно включить иерархию и создавать визуализации. В зависимости от потребностей организации можно выбрать либо представление дерева, в котором отображается вся иерархия, либо представление плитки, которое является более детальным представлением меньшей части иерархии. Оба представления отображаются рядом. Можно переходить по иерархии, разворачивая и сворачивая дерево иерархии. Одни и те же иерархические параметры визуализации задаются один раз, но применяются как к веб-клиенту, так и к мобильным клиентам. На планшетах визуальные эффекты представляются в измененном формате, подходящем для меньшего форм-фактора. Настраиваемые компоненты, необходимые для иерархической визуализации, поддерживают решение, поэтому их можно переносить между организациями, как и любые другие настройки. Можно настроить атрибуты, представленные в визуализации, настроив экспресс-форму с помощью редактора форм. Требований по написанию кода нет.  
  
<a name="BKMK_Querydata"></a>   
## <a name="query-hierarchical-data"></a>Запрос иерархических данных  
 С Common Data Service для приложений структуры иерархических данных поддерживаются ссылающимися на себя отношениями "один-ко-многим" (1:N) связанных записей. В прошлом для просмотра иерархических данных было необходимо итеративно запрашивать связанные записи. В настоящее время можно запрашивать связанные данные в виде иерархии одним действием. Записи можно запросить с помощью логики **Менее** и **Не менее**. Иерархические операторы **Менее** и **Не менее** доступны при расширенном поиске и в редакторе бизнес-процесса. Дополнительные сведения о том, как использовать эти операторы, см. в разделе [Настройка шагов бизнес-процесса](/flow/configure-workflow-steps). Дополнительные сведения о расширенном поиске см. в разделе [Создание, изменение или сохранение расширенного поиска](https://docs.microsoft.com/dynamics365/customer-engagement/basics/save-advanced-find-search).  
  
 В следующих примерах представлены различные сценарии для запроса иерархий.  
  
 Запрос иерархии организации  
  
 ![Запрос организаций в иерархии организаций](media/query-accounts.png "Запрос организаций в иерархии организаций")  
  
 Запрос иерархии организации, включая связанные действия  
  
 ![Запрос связанных действий организации](media/query-account-related-activities.png "Запрос связанных действий организации")  
  
 Запрос иерархии организации, включая связанные возможные сделки  
  
 ![Запрос возможных сделок организации](media/query-account-related-opportunities.png "Запрос возможных сделок организации")  
  
 Чтобы запросить данные как иерархию, необходимо настроить ссылающиеся на себя отношения "один-ко-многим" (1:N) как иерархические. Чтобы включить иерархию:  
  
1.  Откройте [обозреватель решений](../model-driven-apps/advanced-navigation.md#solution-explorer). 
  
2.  Выберите требуемую сущность, выберите **Отношения 1:N**, затем выберите отношение (1:N). 

3.  В разделе **Определение отношения** задайте в параметре **Иерархические** значение **Да**.  
  
> [!NOTE]
> - Некоторые готовые отношения (1:N) невозможно настроить. Это не позволит установить эти отношения как иерархические.  
> - Для системных отношений со ссылкой на себя можно задавать иерархическое отношение. К таким относятся отношения 1:N со ссылкой на себя системного типа, например, отношение «contact_master_contact».  
  
<a name="BKMK_Visualizedata"></a>   
## <a name="visualize-hierarchical-data"></a>Визуализация иерархических данных  
 К системным сущностям с готовыми визуализациями относятся `Account`, `Position`, `Product` и `User`. В табличном представлении этих сущностей доступен значок с диаграммой иерархии слева от имени записи. Значок иерархии доступен не для всех записей по умолчанию. Значок доступен для записей с родительской записью, дочерней записью или обоими типами записей.  
 
 > [!div class="mx-imgBorder"] 
 > ![Активные организации](media/cust-hs-active-account.png "Активные организации")  
  
 Если нажать значок иерархии, можно просмотреть иерархию с представлением дерева в левой части и представлением плитки в правой части, как показано ниже.  
  
> [!div class="mx-imgBorder"] 
> ![Дерево организаций и представление плиток](media/hierachy-security-accounts-tile-view.png "Дерево организаций и представление плиток")  
  
 Для иерархии можно включить несколько других готовых системных сущностей. Эти сущности включают `Case`, `Contact`, `Opportunity`, `Order`, `Quote`, `Campaign` и `Team`. Для иерархии можно включить любые настраиваемые сущности.  
  
> [!TIP]
>  Если для сущности можно включить поддержку иерархии:  
>  В обозревателе решений разверните требуемую сущность. Вы увидите компонент сущности, называемый **Параметры иерархии**. У сущностей, для которых нельзя включить поддержку иерархии, этого компонента нет, за исключением сущности "Территория сбыта" в Dynamics 365 Customer Engagement. Хотя у сущности "Территория сбыта" присутствует раздел **Параметры иерархии**, включить поддержку иерархии для этой сущности нельзя.  
  
 При создании визуализаций важно помнить следующее:  
  
-   Только одно ссылающееся на себя отношение (1: N) для сущности можно установить как иерархическое. В этом взаимоотношении основная сущность и связанная сущность должны быть одного типа, например account_parent_account или new_new_widget_new_widget.  
  
-   В настоящее время иерархия или визуализация основывается только на одной сущности. Можно открыть иерархию организации, отображающую структуру организации на разных уровнях, но невозможно отобразить организации и контакты в одной визуализации иерархии.  
  
-   Максимальное число полей, которые могут отображаться на плитке, — 4. Если добавить дополнительные поля в экспресс-форму, которая используется для представления плитки, будут отображаться только первые четыре поля.  
  
### <a name="visualization-example"></a>Пример визуализации  
 Рассмотрим пример создания визуализации для настраиваемой сущности. Пользователь создал настраиваемую сущность new_Widget и ссылающееся на себя отношение (1:N) **new_new_widget_new_widget**, а затем отметил его как иерархическое, как показано здесь.  
  
 ![Определение отношения виджета](media/widget-relationship-definition.png "Определение отношения виджета")  
  
 Затем в табличном представлении **Параметры иерархии** он выбрал иерархическое отношение **new_new_widget_new_widget**. В форме пользователь заполнил обязательные поля. Если пользователь еще не отметил отношение (1:N) как иерархическое, ссылка в форме перенаправит его назад в форму определения отношения, в которой можно отметить отношение как иерархическое.  
  
 В качестве параметра **Экспресс-форма** пользователь создает экспресс-форму с именем **Форма плитки иерархии мини-приложения**. В этой форме пользователь добавляет четыре поля для отображения на каждой плитке.  
  
> [!div class="mx-imgBorder"] 
> ![Создание экспресс-формы для виджета](media/create-quickf-orm.png "Создание экспресс-формы для виджета")  
  
 По завершении настройки пользователь создает две записи: "Стандартное мини-приложение" и "Расширенное мини-приложение". После задания расширенного мини-приложения в качестве родительского объекта для стандартного мини-приложения с помощью поля поиска в табличном представлении new_Widget становятся доступны значки иерархии, как показано ниже.  
  
> [!div class="mx-imgBorder"] 
> ![Иерархическая сетка виджета](media/widget-hierarchy-grid.png "Иерархическая сетка виджета")  
  
> [!TIP]
>  Значки иерархии не будут доступны в табличном представлении, пока записи не будут связаны отношением "родительский объект — дочерний объект".  
  
 При нажатии значка иерархии отобразится иерархия new_Widget с представлением дерева в левой части и представлением плитки в правой части, отображая две записи. Каждая плитка включает четыре поля, указанные в разделе **Форма плитки иерархии мини-приложения**.  
 
 > [!div class="mx-imgBorder"] 
 > ![Представления дерева и плиток для виджета](media/widget-tree-tiles.png "Представления дерева и плиток для виджета")  
  
## <a name="see-also"></a>См. также  
 [Видео: Моделирование иерархической безопасности](http://www.youtube.com/watch?v=kx5So32DrCo&index=10&list=PLC3591A8FE4ADBE07)   
 [Видео: Визуализация иерархии](http://www.youtube.com/watch?v=_dGBE6icLNw&index=9&list=PLC3591A8FE4ADBE07)
