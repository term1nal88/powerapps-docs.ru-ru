---
title: Отправка запросов и визуализация иерархических данных с помощью PowerApps | Документация Майкрософт
description: Сведения об отправке запросов к иерархическим связанным данным и о визуализации этих данных
ms.custom: ''
ms.date: 06/20/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
author: Mattp123
ms.assetid: 0cf62817-5ff5-40bb-ad17-e1f6b0921720
caps.latest.revision: 42
ms.author: matp
manager: kvivek
ms.openlocfilehash: ec45f43266c1920d05301c92bdd67838b40b7734
ms.sourcegitcommit: aba996b1773ecdf62758e06b34eaf57bede29e08
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/08/2018
ms.locfileid: "39699267"
---
# <a name="query-and-visualize-hierarchically-related-data"></a>Отправка запросов к иерархическим связанным данным и их визуализация

Вы можете получить ценную аналитическую информацию, визуализировав иерархические связанные данные. Возможности иерархического моделирования и визуализации предоставляют ряд преимуществ.  
  
-   Просмотр и изучение сложной иерархической информации.  
  
-   Просмотр ключевых показателей эффективности в контекстуальном представлении иерархии.  
  
-   Визуальный анализ ключевой информации при работе с веб-сайтом и планшетами.  
  
Для некоторых объектов, таких как учетная запись и пользователь, визуализации предоставляются встроенными. Для других сущностей, включая настраиваемые сущности, можно включить иерархию и создавать визуализации. В соответствии со своими потребностями вы можете выбрать представление в виде дерева, в котором отображается вся иерархия, или представление в виде плиток, в котором отображается меньшая часть иерархии. Оба представления отображаются рядом друг с другом. Вы можете просмотреть иерархию, разворачивая и сворачивая элементы дерева иерархии. Одни и те же иерархические параметры визуализации устанавливаются один раз, но применяются как к мобильным клиентам, так и к клиентам с веб-интерфейсом. В планшетных ПК визуальные элементы отображаются в измененном формате в соответствии с меньшим форм-фактором. Пользовательские компоненты, необходимые для иерархической визуализации, зависят от решения, поэтому они могут передаваться между организациями, как и любые другие пользовательские настройки. Вы можете настроить атрибуты, отображаемые в визуализации, изменив экспресс-форму в редакторе форм. Написание кода не требуется.  
  
<a name="BKMK_Querydata"></a>   
## <a name="query-hierarchical-data"></a>Запрос иерархических данных  
 С помощью Common Data Service для приложений структуры иерархических данных поддерживаются самореферентные отношения связанных записей "один ко многим" (1:N). В прошлом для просмотра иерархических данных вам приходилось итеративно запрашивать связанные записи. В настоящее время их можно запросить за один шаг как иерархию. Записи можно запросить с помощью логики **Входит** и **Не входит**. Иерархические операторы **Входит** и **Не входит** доступны при расширенном поиске и в редакторе бизнес-процесса. Дополнительные сведения о том, как использовать эти операторы, см. в разделе [Configure workflow stages and steps](/flow/configure-workflow-steps) (Настройка этапов и действий рабочего процесса). Дополнительные сведения о расширенном поиске см. в разделе [Создание, изменение или сохранение расширенного поиска](https://docs.microsoft.com/dynamics365/customer-engagement/basics/save-advanced-find-search).  
  
 В следующих примерах представлены различные сценарии для запроса иерархий.  
  
 Запрос иерархии учетной записи  
  
 ![Запрос учетных записей в иерархии учетной записи](media/query-accounts.png "Запрос учетных записей в иерархии учетной записи")  
  
 Запрос иерархии учетной записи, включая связанные действия  
  
 ![Запрос связанных с учетной записью действий](media/query-account-related-activities.png "Запрос связанных с учетной записью действий")  
  
 Запрос иерархии учетной записи, включая связанные с ней возможности  
  
 ![Запрос связанных с учетной записью возможностей](media/query-account-related-opportunities.png "Запрос связанных с учетной записью возможностей")  
  
 Чтобы запросить данные как иерархию, необходимо указать сущность с самореферентными отношениями "один ко многим" (1:N) как иерархическую. Действия, необходимые для включения иерархии.  
  
1.  Откройте [Обозреватель решений](../model-driven-apps/advanced-navigation.md#solution-explorer). 
  
2.  Выберите нужную сущность, нажмите **1:N Relationships** (Отношения 1:N), а затем выберите отношение (1:N). 

3.  В разделе **Определение отношения** задайте параметру **Hierarchical** (Иерархическое) значение **Да**.  
  
> [!NOTE]
> - Некоторые готовые отношения (1:N) невозможно настроить. Это не позволит установить эти отношения как иерархические.  
> - Иерархическое отношение можно задавать для системных самореферентных отношений. К ним относятся самореферентные отношения 1:N системного типа, например отношение "contact_master_contact".  
  
<a name="BKMK_Visualizedata"></a>   
## <a name="visualize-hierarchical-data"></a>Визуализация иерархических данных  
 Системные сущности со встроенной визуализацией включают `Account`, `Position`, `Product` и `User`. В представлении этих сущностей в виде сетки слева от имени записи видно значок, представляющий диаграмму иерархии. Значок иерархии по умолчанию отображается не для всех записей. Значок отображается для записей, в которых есть родительская запись, дочерняя запись или обе.  
  
 ![Активные учетные записи](media/cust-hs-active-account.png "Активные учетные записи")  
  
 Щелкнув значок иерархии, можно просмотреть иерархию с представлением в виде дерева слева и представлением в виде плиток справа.  
  
 ![Представление учетной записи в виде дерева и плиток](media/hierachy-security-accounts-tile-view.png "Представление учетной записи в виде дерева и плиток")  
  
 Можно включить поддержку иерархии для некоторых других встроенных системных сущностей. Эти сущности включают `Case`, `Contact`, `Opportunity`, `Order`, `Quote`, `Campaign` и `Team`. Можно включить поддержку иерархии для всех настраиваемых сущностей.  
  
> [!TIP]
>  Если для сущности можно включить поддержку иерархии, сделайте следующее.  
>  В обозревателе решений разверните необходимую сущность. Отобразится компонент сущности, называемый **Hierarchy Settings** (Параметры иерархии). Сущности, для которых нельзя включить иерархию, не содержат этого компонента, за исключением сущности "Территория продаж", связанной с клиентами Dynamics 365. Несмотря на то что для сущности "Территория продаж" отображается компонент **Hierarchy Settings** (Параметры иерархии), для нее невозможно включить иерархию.  
  
 При создании визуализаций важно учитывать следующие аспекты.  
  
-   В качестве иерархического отношения можно использовать только одно самореферентное отношение (1:N) для каждой сущности. В этом отношении первичная и связанная сущности должны быть одного типа, например account_parent_account или new_new_widget_new_widget.  
  
-   В настоящее время иерархия или визуализация могут быть основаны только на одной сущности. Можно отобразить иерархию учетных записей с учетными записями на нескольких уровнях, но нельзя отобразить учетные записи и контакты в одной и той же визуализации иерархии.  
  
-   Максимальное число полей, которые могут быть отображены в плитке, — четыре. При добавлении дополнительных полей в экспресс-форму, которая используется для представления в виде плиток, будут отображаться только первые четыре поля для каждой плитки.  
  
### <a name="visualization-example"></a>Пример визуализации  
 Давайте рассмотрим пример создания визуализации для настраиваемой сущности. Мы создали настраиваемую сущность под названием new_Widget и самореферентное отношение (1:N) **new_new_widget_new_widget**, которое пометили как иерархическое.  
  
 ![Определение отношения мини-приложения](media/widget-relationship-definition.png "Определение отношения мини-приложения")  
  
 Затем в представлении сетки **Hierarchy Settings** (Параметры иерархии) мы выбрали иерархическое отношение **new_new_widget_new_widget**. Мы заполнили необходимые поля в форме. Если вы еще не отметили отношение (1:N) как иерархическое, щелкните ссылку на форме, чтобы открыть форму определения отношения, в которой это можно сделать.  
  
 В качестве **экспресс-формы** мы создали экспресс-форму под названием **Форма плиток иерархии мини-приложения**. В этой форме мы добавили четыре поля, которые будут отображаться в плитках.  
  
 ![Создание экспресс-формы для мини-приложения](media/create-quickf-orm.png "Создание экспресс-формы для мини-приложения")  
  
 После завершения установки мы создали две записи: мини-приложение категории "Стандартный" и мини-приложение категории "Премиум". После того как мы сделали мини-приложение категории "Премиум" родительским для мини-приложения категории "Стандартный" с помощью поля поиска, в представлении сетки new_Widget появились значки иерархии, показанные ниже.  
  
 ![Сетка иерархии мини-приложения](media/widget-hierarchy-grid.png "Сетка иерархии мини-приложения")  
  
> [!TIP]
>  Значки иерархии не отображаются в представлении сетки до тех пор, пока записи не будут спарены в отношениях "родительский элемент — дочерний элемент".  
  
 Щелкнув значок иерархии, можно просмотреть иерархию new_Widget с представлением в виде дерева слева, представлением в виде плиток справа и двумя записями. Каждая плитка содержит четыре поля, которые были указаны в **Форме плиток иерархии мини-приложения**.  
  
 ![Представления мини-приложения в виде дерева и плиток](media/widget-tree-tiles.png "Представления мини-приложения в виде дерева и плиток")  
  
## <a name="see-also"></a>См. также  
 [Video: Hierarchical Security Modelling](http://www.youtube.com/watch?v=kx5So32DrCo&index=10&list=PLC3591A8FE4ADBE07)  (Видео. Моделирование иерархической безопасности)  
 [Video: Hierarchy Visualization](http://www.youtube.com/watch?v=_dGBE6icLNw&index=9&list=PLC3591A8FE4ADBE07) (Видео. Визуализация иерархии)
