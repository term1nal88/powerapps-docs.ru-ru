---
title: Определение вычисляемых полей в PowerApps | MicrosoftDocs
description: Сведения об определении вычисляемых полей
ms.custom: ''
ms.date: 05/25/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
  - Dynamics 365 (online)
  - Dynamics 365 Version 9.x
  - powerapps
author: Mattp123
ms.assetid: 6d58a297-2ddf-4236-be3a-47249b49d5fa
caps.latest.revision: 67
ms.author: matp
manager: kvivek
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---
# <a name="define-calculated-fields-to-automate-manual-calculations"></a>Определение вычисляемых полей для автоматизации ручных расчетов

Используйте вычисляемые поля, чтобы автоматизировать выполняемые вручную вычисления, которые используются в бизнес-процессах. 

Например, продавцу может потребоваться узнать взвешенный доход по возможной сделке, основанный на значении предполагаемого дохода от возможной сделки, умноженного на вероятность. Либо требуется автоматически применить скидку на заказы стоимостью более 500 долларов. Вычисляемое поле может содержать значения, полученные по результатам простых математических операций или условных операций, например "больше чем" или "если, то" и т. д. Для достижения этого можно воспользоваться PowerApps, нет необходимости создавать код.  
  
## <a name="capabilities"></a>Возможности
  
- Вычисляемые поля используют поля из текущей сущности или связанных дочерних сущностей.  
- Поддержка выражения доступна в полях текущей сущности и связанных полях родительской сущности в разделах **Условие** и **Действие**. К встроенным функциям относятся:  
 **ADDHOURS**, **ADDDAYS**, **ADDWEEKS**, **ADDMONTHS**, **ADDYEARS**, **SUBTRACTHOURS**, **SUBTRACTDAYS**, **SUBTRACTWEEKS**, **SUBTRACTMONTHS**, **SUBTRACTYEARS**, **DIFFINDAYS**, **DIFFINHOURS**, **DIFFINMINUTES**, **DIFFINMONTHS**, **DIFFINWEEKS**, **DIFFINYEARS**, **CONCAT**, **TRIMLEFT** и **TRIMRIGHT**.  
- Мощная условная поддержка обеспечивает ветвление и возможность работы с большим количеством условий. Логические операции включают операторы **И** и **ИЛИ**.  
- Возможности визуального редактирования включают современный пользовательский интерфейс и элементы Intellisense в разделе **ДЕЙСТВИЕ**. 
- Беспроблемная интеграция вычисляемых полей в формы, представления, диаграммы и отчеты осуществляется в реальном времени.  
- Вычисляемые поля можно настроить для использования настраиваемых элементов управления.  
  
  
## <a name="scenarios"></a>Сценарии
  
- **Взвешенный доход**: предполагаемый доход, умноженный на вероятность  
- **Чистая стоимость**: активы за минусом обязательств для данной организации  
- **Стоимость труда**: базовая ставка до 40 часов и доп. переработка  
- **Номер контакта**: номер телефона для возможной сделки на основе данных организации или контакта  
- **Балл интереса**: одно поле, которое предоставляет сведения о качестве данного интереса  
- **Дальнейшие действия**: дальнейшие действия за указанное количество дней с учетом приоритета  
  
> [!IMPORTANT]
>  Для создания вычисляемого поля необходимо иметь привилегию на запись в [сущности профиля безопасности поля](/powerapps/developer/common-data-service/reference/entities/fieldsecurityprofile). Если вычисляемое поле использует защищенные поля в вычислении, необходимо подумать о целесообразности защиты и вычисляемого поля, чтобы не дать пользователям возможность осуществлять доступ к данным без достаточных разрешений. Редактор вычисляемого поля отображает предупреждение, если создается вычисляемое поле, использующее безопасные поля в вычислении, и предлагает обеспечить безопасность вычисляемого поля. Дополнительные сведения: [Безопасность на уровне полей для контроля доступа](/dynamics365/customer-engagement/admin/field-level-security).  

## <a name="create-a-calculated-field"></a>Создание вычисляемого поля

С помощью редактора поля укажите вычисляемое поле. В этом примере мы будем использовать [PowerApps](https://web.powerapps.com/?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc), но при использовании обозревателя решений шаги аналогичны. Дополнительные сведения: [Создание и изменение полей](create-edit-fields.md)
  
1. Откройте [PowerApps](https://web.powerapps.com/?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc)
1. Разверните **Данные** > **Сущности**.  
1. Выберите требуемую сущность и щелкните **Поля**. Выберите **Добавить поле**.  
1. Введите обязательные сведения для поля, включая **Отображаемое имя**, **Имя** и **Тип данных**. 
1. Если тип данных — это один из типов, который поддерживает вычисляемые поля, можно сделать поле вычисляемым, выбрав **Добавив** > **Вычисление**.

    ![Сделать поле вычисляемым](media/make-field-calculated-maker.png)

    Эти типы полей поддерживают вычисления:
    - Текст
    - Набор параметров  
    - Два параметра  
    - Целое число  
    - Десятичное число  
    - Валюта  
    - Дата и время

1. При выборе **Вычисление** требуется сохранить изменения в сущности. Для продолжения нажмите **Сохранить** в диалоге **Ожидающие изменения**.
1. В результате открывается редактор определений вычисляемого поля, где создается новое вычисляемое поле для которого, однако, не задается никакая формула. Определение вычисляемого поля состоит из двух разделов: **УСЛОВИЕ** и **ДЕЙСТВИЕ**.  
  ![Форма создания расчета поля](media/empty-field-calculation.png)
- В разделе **Условие** можно задать сущность, поле, оператор, вид и значение. В раскрывающемся списке для **Сущность** можно выбрать текущую сущность или связанную сущность. В раскрывающемся списке **Поле** можно выбрать все доступные поля для сущности. В зависимости от выбранного оператора может потребоваться указать тип и значение. Можно выбрать несколько условий с помощью операторов `AND` или `OR`.  
- В разделе **Действие** указывается формула для вычисляемого поля.  
  
> [!NOTE]
>  В действии можно использовать данные из записей поиска. Сначала необходимо выбрать поле поиска, а затем ввести точку. После этого можно выбрать одно из полей, доступных в связанной сущности. Например, в случае *`<LookupFieldName>.<RelatedFieldName>`* можно выбрать: `ParentAccountId.AccountNumber`.  
>   
>  Обратите внимание, что безопасность на уровне полей для связанной сущности учитываться не будет, поэтому если поле, к которому производится доступ, содержит конфиденциальные данные, рекомендуется также защитить и создаваемое вами вычисляемое поле.  


<a name="BusinessScenarios"></a> 
  
## <a name="examples"></a>Примеры  

Рассмотрим подробнее примеры вычисляемых полей. 
  
### <a name="weighted-revenue-of-opportunity"></a>Взвешенный доход от возможной сделки

В этом примере мы используем поля сущностей возможной сделки, чтобы рассчитать взвешенный доход по вероятности закрытия возможной сделки. В редакторе поля для сущностей возможной сделки создадим поле **Взвешенный доход** и укажем тип поля — **Вычисляемое**, а тип данных — **Валюта**.

В редакторе определения вычисляемого поля в разделе **Условие** определим возможную сделку со статусом = открытая. В разделе **ДЕЙСТВИЕ** формула вычисляет взвешенный доход на основе рассчитанного дохода от возможной сделки, умноженного на вероятность ее заключения.  На следующих снимках экрана изображена пошаговая инструкция по определению вычисляемого поля **Взвешенный доход**.  
  
#### <a name="set-the-condition-on-the-opportunities"></a>Укажите условие в возможных сделках:
  
![Настройка взвешенного дохода в Dynamics 365](media/calc-field-open-opportunity.png)  
  
#### <a name="provide-the-formula-for-the-weighted-revenue"></a>Укажите формулу для расчета взвешенного дохода: 
  
![Предполагаемое значение "Задать взвешенный доход" в Dynamics 365](media/calc-field-open-opportunities-3.png)  
  
#### <a name="altogether"></a>Вместе:
  
![Соотношение взвешенного дохода к предполагаемому в Dynamics 365](media/calculated-field-open-opportunity.png)  
  
### <a name="follow-up-date-of-opportunity"></a>Дата дальнейших действий по возможной сделке 
 
В этом примере мы используем поля полученного интереса из возможной сделки для вычисления оптимальной даты дальнейших действий по возможной сделке. 

В редакторе поля для сущностей возможной сделки создадим поле **Дата дальнейших действий** и укажем тип поля — **Вычисляемое**, а тип данных — **Дата и время**.  

В редакторе определения вычисляемого поля в разделе **Условие** будет определяться два условия: интервал времени покупки и предполагаемая стоимость интереса. 

В поле **ДЕЙСТВИЕ** мы укажем две формулы:
 - Для дальнейших действий через одну неделю по немедленной возможной сделке
 - Для дальнейших действий через один месяц, если не ожидается, что возможная сделка произойдет прямо сейчас. 

На следующих снимках экрана изображена пошаговая инструкция по определению вычисляемого поля **Дата дальнейших действий**.  
  
#### <a name="set-the-two-conditions-on-the-originating-lead"></a>Задаем два условия для появившегося интереса:
  
![Дальнейшие действия с датой возможности в Dynamics 365](media/calc-field-follow-update-2.PNG)  
  
![Дальнейшие действия с датой возможности в Dynamics 365](media/calc-field-follow-update-3.PNG)  
  
#### <a name="provide-the-formula-to-follow-up-in-one-week"></a>Предоставляем формулу для определения дальнейших действий в течение недели:
  
![Дальнейшие действия с датой возможности в Dynamics 365](media/calc-field-follow-update-4.PNG)  
  
#### <a name="provide-the-formula-to-follow-up-in-one-month"></a>Предоставляем формулу для дальнейших действий в течение месяца:
  
![Установка даты дальнейшего действия в Dynamics 365](media/calc-field-follow-update-5.PNG)  
  
#### <a name="altogether"></a>Вместе:
  
 ![Настройка логических выражений If-Then и Else для даты дальнейшего действия в Dynamics 365](media/calc-field-follow-update-6.PNG)  
  
### <a name="days-from-a-record-creation"></a>Число дней с момента создания записи 
 
В этом примере мы используем функцию **DIFFINDAYS**, чтобы вычислить разницу в днях между временем создания записи и текущей датой. 

Создайте новое целочисленное поле с именем **Вычисленная разница в днях**.
  
#### <a name="provide-the-formula-for-computing-the-difference-in-days"></a>Введите формулу для вычисления разницы в днях:
  
![Вычисляемое поле, функция DIFFINDAYS](media/custom-calc-field-diff-days.png)  
  
#### <a name="altogether"></a>Вместе:
  
![Разница в днях с создания записи](media/calc-field-diff-days-complete.png)  
  
<a name="Syntax"></a> 
  
## <a name="functions-syntax"></a>Синтаксис функций  

В следующей таблице приводятся сведения о синтаксисе функций, предоставленных в разделе **ДЕЙСТВИЕ** вычисляемого поля.  
  
> [!TIP]
>  Имена функций указываются заглавными буквами.  
  
|Синтаксис функций|Описание|Возвращаемый тип|  
|---------------------|-----------------|-----------------|  
|**ADDDAYS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени плюс определенное количество дней.|Дата и время|  
|**ADDHOURS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени плюс определенное количество часов.|Дата и время|  
|**ADDMONTHS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени плюс определенное количество месяцев.|Дата и время|  
|**ADDWEEKS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени плюс определенное количество недель.|Дата и время|  
|**ADDYEARS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени плюс определенное количество лет.|Дата и время|  
|**SUBTRACTDAYS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени минус определенное количество дней.|Дата и время|  
|**SUBTRACTHOURS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени минус определенное количество часов.|Дата и время|  
|**SUBTRACTMONTHS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени минус определенное количество месяцев.|Дата и время|  
|**SUBTRACTWEEKS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени минус определенное количество недель.|Дата и время|  
|**SUBTRACTYEARS** (целое число, дата и время)|Возвращает новую дату и время, равные дате и времени минус определенное количество лет.|Дата и время|  
|**DIFFINDAYS** (дата и время, дата и время)|Возвращает разницу в днях между двумя полями **Дата и время**. Если оба момента во времени припадают на один и тот же день, разница равна нулю.|Целое число|  
|**DIFFINHOURS** (дата и время, дата и время)|Возвращает разницу в часах между двумя полями **Дата и время**.|Целое число|  
|**DIFFINMINUTES** (дата и время, дата и время)|Возвращает разницу в минутах между двумя полями **Дата и время**.|Целое число|  
|**DIFFINMONTHS** (дата и время, дата и время)|Возвращает разницу в месяцах между двумя полями **Дата и время**. Если оба момента во времени припадают на один и тот же месяц, разница равна нулю.|Целое число|  
|**DIFFINWEEKS** (дата и время, дата и время)|Возвращает разницу в неделях между двумя полями **Дата и время**. Если оба момента во времени припадают на одну и ту же неделю, разница равна нулю.|Целое число|  
|**DIFFINYEARS** (дата и время, дата и время)|Возвращает разницу в годах между двумя полями **Дата и время**. Если оба момента во времени припадают на один и тот же год, разница равна нулю.|Целое число|  
|**CONCAT** (одна строка текста, одна строка текста, одна строка текста, ... одна строка текста)|Возвращает строку, которая является результатом объединения двух и более строк.|String|  
|**TRIMLEFT** (одна строка текста, целое число)|Возвращает строку, содержащую копию указанной строки без указанного количества первых символов.|String|  
|**TRIMRIGHT** (одна строка текста, целое число)|Возвращает строку, содержащую копию указанной строки без указанного количества последних символов.|String|  
  
> [!NOTE]
>  Все функции DIFF требуют, чтобы первое поле **Дата и время** и второе поле **Дата и время** имел и одинаковое поведение: **Часовой пояс пользователя**, **Только дата** или **Независимо от часового пояса**. Если поведение второго поля не соответствует поведению первого поля, то отображается сообщение об ошибке с указанием того, что второе поле нельзя использовать в текущей функции. Дополнительные сведения: [Поведение и формат поля "Дата и время"](behavior-format-date-time-field.md).  
  
> [!NOTE]
>  Невозможно ввести дату, например 01.01.2015, в качестве значения Date в вычисляемое поле. Значения Date и DateTime можно задать или сравнить только с помощью других полей DateTime.  
  
В функции **CONCAT** можно использовать буквенные строки как отдельные строки текста, поля сущности, содержащие отдельную строку текста, или и то, и другое. Например, **CONCAT** (Имя, Фамилия, "является руководителем"). Если буквенная строка содержит прямые кавычки, перед каждой меткой добавьте символ наклонной черты (\\), например `This string contains the \"quotation marks.\"`. Это гарантирует, что прямые кавычки в строке не будут рассматриваться как специальные символы, разделяющие строки.  
  
В следующих примерах показано, как использовать функции **TRIMLEFT** и **TRIMRIGHT**. Они содержат исходные и полученные строки, возвращенные функциями **TRIMLEFT** и **TRIMRIGHT**:  
  
**TRIMLEFT** ("RXX10-3456789", 3) возвращает строку `10-3456789`    
**TRIMRIGHT** ("20-3456789RXX", 3) возвращает строку `20-3456789` 
  
<a name="Considerations"></a> 
  
## <a name="considerations"></a>Рекомендации 
 
При работе с вычисляемыми полями следует учитывать ряд определенных условий и ограничений:  
  
- Сохраненные запросы, диаграммы и визуализации могут иметь не более 10 уникальных вычисляемых полей.  
- Значения вычисляемых полей не отображаются в автономном режиме клиента Outlook для представлений плитки и в основных формах сущностей.  
- Максимальное число объединенных в цепь вычисляемых полей — 5.  
- Вычисляемое поле не может ссылаться на само себя или иметь циклические цепи.  
- Если изменить один из операторов условия в множественном предложении условия, все операторы условия будут обновлены до этого условия. Например, в предложении `IF (x > 50) OR (y ==10) OR (z < 5)` при изменении оператора `OR` на оператор `AND` все операторы `OR` в предложении станут операторами `AND`.  
- Можно получить доступ к родительским полям через поле поиска в родительской сущности, например *`<LookupFieldName>.<FieldName>`*. Это невозможно с полями подстановки для нескольких сущностей (например, "Клиент"), которые могут являться полями "Организация" или "Контакт". Однако некоторые сущности имеют отдельные поля поиска для определенной сущности, такой как `ParentAccountid.`*`<FieldName>`* или `ParentContactid.`*`<FieldName>`*.  
- Сортировка отключена:  
  - Вычисляемое поле, содержащее поле из родительской записи.  
  - Вычисляемое поле, содержащее логическое поле (например, поле адреса)
  - Вычисляемое поле, содержащее другое вычисляемое поле.  
- Вычисляемые поля могут охватывать только две сущности.  
  - Вычисляемое поле может содержать поле из другой сущности (охватывающее две сущности — текущую сущность и родительскую запись).  
  - Вычисляемое поле не может содержать вычисляемое поля из другой сущности, которое также содержит другое поле из другой сущности (всего 3 сущности):   
    (Текущая сущность) Вычисляемое поле &larr; (Родительская запись) Вычисляемое поле 1 &larr; (Родительская запись) Вычисляемое поле 2.  
- Невозможно инициировать бизнес-процессы или подключаемые модули в вычисляемых полях.  
- Невозможно изменить существующее простое поле на вычисляемое поле. Если текущее приложение использует JavaScript или подключаемый модуль для вычисления поля, вы не сможете использовать функцию вычисляемых полей без создания нового поля.  
- Правила поиска повторяющихся данных для вычисляемых полей не запускаются.  
- Свертка не может ссылаться на вычисляемое поле, использующее другое вычисляемое поле, даже если все поля другого вычисляемого поля находятся в текущей сущности.  
  
### <a name="see-also"></a>См. также
 
[Создание и изменение полей](create-edit-fields.md)<br />
[Определение полей свертки, которые агрегируют значения](define-rollup-fields.md)<br />
[Видео: поля свертки и вычисляемые поля](http://go.microsoft.com/fwlink/p/?LinkId=517727)
