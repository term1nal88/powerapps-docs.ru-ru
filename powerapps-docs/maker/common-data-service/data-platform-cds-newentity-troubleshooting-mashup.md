---
title: Устранение неполадок с Power Query | Microsoft Docs
description: Устранение неполадок путем использования Power Query для создания настраиваемой сущности в Common Data Service для приложений.
author: mllopis
manager: kfile
ms.service: powerapps
ms.component: cds
ms.topic: conceptual
ms.date: 05/16/2018
ms.author: millopis
search.audienceType:
  - maker
search.app:
  - PowerApps
  - D365CE
---

# <a name="troubleshoot-power-query"></a>Устранение неполадок с Power Query
При использовании Power Query для Excel для создания настраиваемой сущности с данными из внешних источников, эта ошибка может появиться:

>"Администратор Azure Active Directory установил политику, которая не позволит вам использовать эту функцию. Обратитесь к администратору, который может предоставлять разрешения для этой функции от вашего лица."

Эта ошибка появляется, если Power Query не удается получить доступ к данным организации в PowerApps или Common Data Service для приложений. Эта ситуация возникает в двух наборах ситуаций:

* Администратор клиента Azure Active Directory (Azure AD) запретил пользователям давать согласие приложениям, которые получают доступ к данным компании от их имени.
* Использование неуправляемого клиента Active Directory. Неуправляемый клиент — это каталог без глобального администратора, который был создан для завершения предложения подписки самообслуживания. Чтобы исправить этот сценарий, пользователи сначала должны выполнить преобразование в управляемый клиент, затем выполнить одно из двух решений этой проблемы. Решения описаны в следующем разделе.

Чтобы устранить эту проблему, администратор Azure Active Directory должен выполнить любую из этих процедур, представленных ниже в этой статье.

## <a name="allow-users-to-consent-to-apps-that-access-company-data"></a>Разрешение пользователям давать согласие приложениям, которые получают доступ к данным компании
Этот подход, возможно, легче следующего, но это разрешает более широкие разрешения.

1. На [портале Azure](https://portal.azure.com) откройте панель **Azure Active Directory**, затем выберите **Параметры пользователя**.
2. Рядом с пунктом **Пользователи могут давать приложениям разрешение на доступ к данным компании от их имени** выберите **Да**, затем выберите **Сохранить**.

## <a name="allow-power-query-to-access-company-data"></a>Разрешение Power Query получать доступ к данным компании
Альтернативно администратор клиента может предоставить согласие Power Query без изменения разрешений на уровне всего клиента.

1. Установите [Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-azurerm-ps).
2. Выполните следующие команды PowerShell:
   * Login-AzureRmAccount (и войдите в систему как администратор клиента)
   * New-AzureRmADServicePrincipal -ApplicationId f3b07414-6bf4-46e6-b63f-56941f3f4128

Преимущество этого подхода (по сравнению с решением в масштабах всего клиента) заключается в том, что это очень направленное решение. Оно подготавливает только участника-службу **Power Query**, но не изменяет никакие другие разрешения в клиенте.

## <a name="update-personal-data"></a>Обновление личных данных

Пользователи могут обновлять гибридные веб-приложения и другие данные (например, имена запросов и метаданные гибридных веб-приложений) с помощью редактора запросов или в диалоговом окне **Параметры**, доступном из редактора запросов.

В PowerApps вы получаете доступ к редактору запросов, выполнив следующие действия.
1. Перейдите на панель **Данные**, разверните ее, затем выберите **Сущности**. 
2. Выберите многоточие (...), затем выберите **Изменить запросы**.
3. На ленте выберите кнопку **Параметры**, затем выберите кнопку **Экспорт диагностики**.


## <a name="delete-personal-data"></a>Удаление личных данных

Большинство данные будут удалены автоматически в течение 30 дней. Для данных и метаданных о гибридных веб-приложениях пользователи должны удалять все свои гибридные веб-приложения через PowerApps. Все связанные данные и метаданные будут удалены в течение 30 дней.

Для удаления гибридных веб-приложений из PowerApps:
1. Удалите проекты интегратора данных, которые могут быть удалены с одноименной вкладки.
2. Выберите многоточие (...), затем выберите параметр **Удалить**.

Если гибридное веб-приложение было создано с помощью функции "Новые сущности из данных (технический предварительный просмотр)", его можно удалить, выполнив следующие действия.
1. Выберите многоточие (...), затем выберите **Изменить запросы**.
2. На ленте выберите кнопку **Параметры**.
3. Выберите кнопку **Удалить все запросы**.  
    После подтверждения, что требуется удалить запросы, они удаляются.

## <a name="export-personal-data"></a>Экспорт личных данных

Чтобы экспортировать личные данные, пользователи могут выполнить следующие действия:
1. Откройте редактор запросов.
2. На ленте выберите кнопку **Параметры**.
3. Выберите кнопку **Экспорт диагностики**.

В PowerApps вы можете открыть редактор запросов, выполнив следующие действия.
1. Перейдите на панель **Данные**, разверните ее, затем выберите **Сущности**.
2. Выберите многоточие (...), затем выберите **Изменить запросы**. 
3. На ленте выберите кнопку **Параметры**, затем выберите кнопку **Экспорт диагностики**.

Созданные системой журналы о действиях пользователя в пользовательском интерфейсе (UI) можно просмотреть на портале Azure.



