---
title: Общие сведения о делегировании | Документация Майкрософт
description: Делегирование помогает эффективно обрабатывать большие наборы данных.
documentationcenter: na
author: gregli-msft
manager: kfile
editor: ''
tags: ''
ms.service: powerapps
ms.devlang: na
ms.topic: conceptual
ms.component: canvas
ms.date: 07/05/2018
ms.author: gregli
ms.openlocfilehash: 7e9a6aac1e0df32fa83edaa0b8042dd2df143bf2
ms.sourcegitcommit: 79b8842fb0f766a0476dae9a537a342c8d81d3b3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/07/2018
ms.locfileid: "37897485"
---
# <a name="understand-delegation"></a>Общие сведения о делегировании
PowerApps поддерживает целый ряд эффективных и полезных функций для фильтрации, сортировки и форматирования таблиц с данными, такие как **[Filter](functions/function-filter-lookup.md)**, **[Sort](functions/function-sort.md)**, **[AddColumns](functions/function-table-shaping.md)** и многие другие. Эти функции помогают обеспечить пользователям доступ именно к той информации, которая им необходима. Для тех, у кого есть опыт работы с базами данных, использование этих функций можно сравнить с составлением запросов к базе.

Залогом создания эффективных приложений является минимизация объема данных, которые необходимо загружать на устройства. Иногда необходимы лишь несколько из миллионов записей или одно обобщенное (статистическое) значение, которое характеризует тысячи элементов в базе. Кроме того, возможно, достаточно будет извлечь лишь первый набор записей, а остальные можно загружать по требованию пользователя. Учитывая эти моменты, можно существенно сократить потребность в процессорной мощности, памяти и полосе пропускания, необходимых приложению, что в свою очередь ускорит его реагирование на действия пользователей, причем даже на телефонах, подключенных к Интернету через сотовый канал связи. 

*Делегирование* позволяет минимизировать объемы данных, передаваемые через сеть, не жертвуя при этом функциональными возможностями формул PowerApps. Вкратце PowerApps делегирует обработку данных источнику вместо переноса данных в приложение для локальной обработки.

Такая возможность существует не всегда, и, как объясняется в этой статье, не все функции и возможности формул PowerApps можно делегировать каждому источнику данных. Язык PowerApps аналогичен языку формул Excel и предполагает полный и мгновенный доступ ко всему содержимому книги в памяти, включая широкий набор функций для работы с числами и текстом. Благодаря этому возможности языка PowerApps намного шире, чем те, что поддерживаются большинством источников данных, включая такие мощные и функциональные СУБД, как SQL Server.

**Для работы с большими наборами данных необходимо использовать источники и формулы, которые можно делегировать.**  Только так можно сохранить работоспособность приложения на высоком уровне и обеспечить пользователям доступ ко всей необходимой им информации. Обращайте внимание на предупреждения о делегировании, которые указывают на места, где делегирование невозможно. Если вы работаете с небольшими наборами данных (до 500 записей), можно использовать любые источники данных и формулы, так как приложение может обрабатывать данные локально даже в случае, если формулу нельзя делегировать. 

> [!NOTE]
> Предупреждения о делегировании раньше помечались в PowerApps как рекомендации с синими точками, но теперь они считаются не рекомендациями, а предупреждениями. Если в источнике данных более 500 записей и невозможно делегировать функцию, PowerApps не сможет получить все данные и приложение получит неверные результаты. Предупреждения о делегировании помогают управлять приложением и получать правильные результаты.

## <a name="delegable-data-sources"></a>Делегируемые источники данных
Полный список источников данных, поддерживающих делегирование (с описанием возможных ограничений), см. в [этом списке](delegation-list.md).

Мы постоянно расширяем поддержку делегирования для существующих источников, а также добавляем новые.

Импортированные книги Excel (для которых используется источник Add static data to your app — добавление статических данных в приложение), коллекции и таблицы, хранимые в переменных контекста, не требуют делегирования. Все эти данные уже находятся в памяти и поддерживают все функциональные возможности языка PowerApps.

## <a name="delegable-functions"></a>Делегируемые функции
Следующий этап заключается в использовании только тех формул, которые можно делегировать. Здесь указаны элементы формул, поддерживающие делегирование. Тем не менее следует помнить, что источники данных различаются, и не все они поддерживают приведенные здесь элементы. Проверьте наличие предупреждений о делегировании в формуле.

Этот список со временем будет меняться. Мы расширяем поддержку делегирования и на другие функции и операторы.

### <a name="filter-functions"></a>Функции фильтрации
Функции **[Filter](functions/function-filter-lookup.md)**, **[Search](functions/function-filter-lookup.md)** и **[LookUp](functions/function-filter-lookup.md)** можно делегировать.  

В функциях **Filter** и **LookUp** для выбора соответствующих записей в столбцах таблицы можно использовать следующие операторы и функции:

* **[And](functions/function-logicals.md)** (включая **[&&](functions/operators.md)**), **[Or](functions/function-logicals.md)** (включая **[||](functions/operators.md)**), **[Not](functions/function-logicals.md)** (включая **[!](functions/operators.md)**)
* **[In](functions/operators.md)**
* **[=](functions/operators.md)**, **[<>](functions/operators.md)**, **[>=](functions/operators.md)**, **[<=](functions/operators.md)**, **[>](functions/operators.md)**, **[<](functions/operators.md)**
* **[+](functions/operators.md)**, **[-](functions/operators.md)**
* **[TrimEnds](functions/function-trim.md)**
* **[IsBlank](functions/function-isblank-isempty.md)**
* **[StartsWith](functions/function-startswith.md)**
* Постоянные значения, одинаковые для всех записей, такие как свойства элемента управления и [глобальные и контекстуальные переменные](working-with-variables.md).

Также можно использовать части формул, которые возвращают константные значения для всех записей. Например, результат выполнения формулы **Left( Language(), 2)** не зависит от содержимого столбцов записи и возвращает одинаковое значение для всех записей. По сути, это постоянное значение. Значения переменных контекста, коллекций и сигналов могут не быть постоянными, что не позволяет делегировать функции **Filter** и **LookUp**.  

Предыдущий список не содержит следующие важные элементы:

* **[If](functions/function-if.md)**
* **[*](functions/operators.md)**, **[/](functions/operators.md)**, **[Mod](functions/function-mod.md)**
* **[Concatenate](functions/function-concatenate.md)** (включая **[&](functions/operators.md)**)
* **[ExactIn](functions/operators.md)**
* Функции для работы со строками: **[Lower](functions/function-lower-upper-proper.md)**, **[Upper](functions/function-lower-upper-proper.md)**, **[Left](functions/function-left-mid-right.md)**, **[Mid](functions/function-left-mid-right.md)**, **[Len](functions/function-left-mid-right.md)**, ...
* Сигналы: **[Location](functions/signals.md)**, **[Acceleration](functions/signals.md)**, **[Compass](functions/signals.md)**, ...
* Меняющиеся значения: **[Now](functions/function-now-today-istoday.md)**, **[Today](functions/function-now-today-istoday.md)**, **[Rand](functions/function-rand.md)**, ...
* [Коллекции](working-with-variables.md)

### <a name="sorting-functions"></a>Функции сортировки
Функции **[Sort](functions/function-sort.md)** и **[SortByColumns](functions/function-sort.md)** можно делегировать.

В функции **Sort** формулой может быть только имя одного столбца, и она не может содержать другие операторы или функции.

### <a name="aggregate-functions"></a>Агрегатные функции
**[Sum](functions/function-aggregates.md)**, **[Average](functions/function-aggregates.md)**, **[Min](functions/function-aggregates.md)** и **[Max](functions/function-aggregates.md)** можно делегировать. Сейчас делегирование поддерживает ограниченное число источников данных. Дополнительные сведения см. в [списке делегирования](delegation-list.md).

Функции подсчета, такие как **[CountRows](functions/function-table-counts.md)**, **[CountA](functions/function-table-counts.md)** и **[Count](functions/function-table-counts.md)**, невозможно делегировать.

Другие агрегатные функции, такие как **[StdevP](functions/function-aggregates.md)** и **[VarP](functions/function-aggregates.md)**, также невозможно делегировать.

## <a name="non-delegable-functions"></a>Неделегируемые функции
Все остальные функции не поддерживают делегирование. Ниже перечислены некоторые из них.

* Форматирование таблиц: **[AddColumns](functions/function-table-shaping.md)**, **[DropColumns](functions/function-table-shaping.md)**, **[ShowColumns](functions/function-table-shaping.md)**, ...
* **[First](functions/function-first-last.md)**, **[FirstN](functions/function-first-last.md)**, **[Last](functions/function-first-last.md)**, **[LastN](functions/function-first-last.md)**
* **[Choices](functions/function-choices.md)**
* **[Concat](functions/function-concatenate.md)**
* **[Collect](functions/function-clear-collect-clearcollect.md)**, **[ClearCollect](functions/function-clear-collect-clearcollect.md)**
* **[CountIf](functions/function-table-counts.md)**, **[RemoveIf](functions/function-remove-removeif.md)**, **[UpdateIf](functions/function-update-updateif.md)**
* **[GroupBy](functions/function-groupby.md)**, **[Ungroup](functions/function-groupby.md)**

Вы можете использовать функции **AddColumns** и **LookUp** для объединения данных из двух таблиц в одну (в контексте баз данных это называется операцией соединения).  Пример.

**AddColumns(Products, "Имя поставщика", LookUp(Suppliers, Suppliers.ID = Product.SupplierID).Name)**

В то время как источники данных **Products** и **Suppliers** могут поддерживать делегирование, а функция **LookUp** является делегируемой, функцию **AddColumns** делегировать нельзя.  Результаты выполнения всей формулы ограничены первой частью источника данных **Products**.  

Поскольку функция **LookUp** и ее источник данных являются делегируемыми, совпадение со значением **Suppliers** может быть найдено в любом месте источника данных (каким бы большим он ни был). Потенциальным недостатком в этой ситуации является тот факт, что функция **LookUp** совершает отдельные обращения к источнику данных для каждой записи из первой части источника **Products**, что повышает нагрузку на сеть. Если источник **Suppliers** достаточно мал и меняется не очень часто, вы можете кэшировать данные из него в приложении, вызывая функцию **Collect** при его запуске (с помощью события [**OnVisible**](controls/control-screen.md) на начальном экране), и обращаться с помощью функции **LookUp** к кэшированной информации.  

## <a name="non-delegable-limits"></a>Ограничения для неделегируемых функций
Формулы, которые нельзя делегировать, обрабатываются локально. Это позволяет использовать все функциональные возможности формул PowerApps. Однако есть и обратная сторона медали: все данные необходимо сначала загрузить на устройство, что может существенно увеличить сетевой трафик. Это занимает некоторое время, создавая впечатление, что приложение работает медленно или даже завершилось сбоем.

Чтобы избежать этого, в PowerApps установлено ограничение на объем данных, обрабатываемых локально: по умолчанию не более 500 записей.  Мы выбрали именно это число, чтобы обеспечить полный доступ к небольшим наборам данных и в то же время дать возможность оптимизировать обработку больших наборов на основе частичных результатов.

Очевидно, этот фактор необходимо учитывать, чтобы не вводить пользователей в заблуждение. Представим ситуацию, в которой функция **Filter** используется в формуле выборки, которую нельзя делегировать, для фильтрации источника данных, содержащего более миллиона записей. Поскольку фильтрация выполняется локально, проверяются только первые 500 записей. Если нужная запись находится под номером 501 (или 500 001), она не будет обработана, а функция **Filter** ее не вернет.

Агрегатные функции также могут привести к путанице. Представим функцию **Average**, примененную к тому же самому источнику данных с миллионом записей. Поскольку делегирование функции **Average** пока не поддерживается, усреднение будет выполнено только по первым 500 записям. Этот фактор необходимо учитывать: в противном случае пользователь приложения ошибочно посчитает полным результат обработки лишь части набора.

## <a name="changing-the-limit"></a>Изменение ограничения
По умолчанию количество записей равно 500, но можно изменить это число для всего приложения:

1. На вкладке **Файл** выберите **Параметры приложения**.
2. В разделе **Экспериментальные функции** измените параметр **Предельное число строк данных для неделегируемых запросов** с 1 до 2000.

В некоторых случаях вам может быть известно, что оптимальным значением для вашего сценария является 2000 (или 1000, или 1500). Это число можно осторожно увеличивать в соответствии с потребностями сценария. Увеличение этого параметра может привести к снижению производительности приложения, особенно для таблиц с большим количеством столбцов. Но лучший вариант — делегировать все, что только можно делегировать.

Чтобы убедиться, что ваше приложение может масштабироваться для больших наборов данных, уменьшите значение этого параметра до 1. Теперь все, что не может быть делегировано, возвратит одну запись. Это легко обнаружить при тестировании приложения. Это поможет избежать сюрпризов при проверке приложения в рабочей среде.

## <a name="delegation-warnings"></a>Предупреждения о делегировании
Чтобы вы всегда знали, что можно, а что нельзя делегировать, PowerApps предоставляет предупреждение (желтый треугольник) при создании формулы с неделегируемыми элементами.

Предупреждения о делегировании отображаются только для формул, которые работают с делегируемыми источниками данных. Если вы не видите подобного предупреждения и считаете, что формула не делегируется надлежащим образом, проверьте, есть ли ваш источник в списке [делегируемых источников данных](delegation-overview.md#delegable-data-sources) выше.

## <a name="examples"></a>Примеры
Например, вы автоматически создаете приложение с тремя экранами на основе таблицы SQL Server с именем **[dbo].[Fruit]**. Чтобы создать такое приложение, смотрите [раздел о Common Data Service для приложений](data-platform-create-app.md) и примените те же принципы для SQL Server.

![Приложение с тремя экранами](./media/delegation-overview/products-afd.png)

Для свойства **Items** коллекции установлена формула, которая содержит функции **SortByColumns** и **Search**. Обе функции можно делегировать.

В поле поиска введите **Apple**.

В верхней части экрана сразу появятся точки, так как приложение взаимодействует с SQL Server для обработки поискового запроса. Отобразятся все записи, соответствующие критериям поиска, даже если источник данных содержит миллионы записей.

![Текстовое поле для поиска](./media/delegation-overview/products-apple.png)

Результаты поиска включают **"Apples"**, **"Crab apples"** и **"Pineapple"**, поскольку функция **Search** ищет по всему текстовому столбцу. Если вы хотите найти только те записи, которые содержат поисковой запрос в начале названия фрукта, используйте другую делегируемую функцию **Filter** для более сложных критериев поиска. (Для простоты удалите вызов **SortByColumns**.)

![Удаление вызова SortByColumns](./media/delegation-overview/products-apple-delegationwarning.png)

Новые результаты включают **"Apples"**, но не **"Crab apples"** или **"Pineapple"**.  Рядом с коллекцией (и в эскизе экрана, если в левой панели навигации отображаются эскизы) отображается желтый треугольник, и часть формулы подчеркивается синей волнистой линией. Каждый из этих элементов указывает на предупреждение. Если навести курсор на желтый треугольник рядом с коллекцией, вы увидите следующее сообщение:

![Наведение указателя мыши на предупреждение о делегировании](./media/delegation-overview/products-apple-yellowwarning.png)

SQL Server является делегируемым источником данных, а **Filter** является делегируемой функцией, однако **Mid** и **Len** невозможно делегировать источнику данных.

Но мы ведь получили нужные результаты? В некотором смысле — да. Поэтому это предупреждение, а не красная волнистая линия.

- Если таблица содержит не более 500 записей, формула дала правильный результат. Все эти записи были загружены на устройство, и функция **Filter** была применена локально.
- Если таблица содержит более 500 записей, формула не возвращает запись 501 и далее, даже если она соответствует критериям.
