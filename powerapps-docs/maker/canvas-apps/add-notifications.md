---
title: Отправка push-уведомлений | Документация Майкрософт
description: Узнайте, как отправлять системные push-уведомления в приложения в PowerApps.
author: jamesol-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: canvas
ms.reviewer: anneta
ms.date: 08/08/2017
ms.author: jamesol
ms.openlocfilehash: 45311aefca51d8d1a4fc6c8cc6dabc33872842df
ms.sourcegitcommit: dfa0e1a7981814e15e6ca4720e2a5f930e859db1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/13/2018
ms.locfileid: "39020844"
---
# <a name="send-a-push-notification-in-powerapps"></a>Отправка push-уведомлений в PowerApps
Push-уведомления используются в мобильных приложениях преимущественно при работе с потребителями и в бизнес-сценариях для привлечения пользователей приложений и определения приоритетности ключевых задач. В PowerApps уведомления можно отправлять с помощью соединителя PowerApps Notification. Системные push-уведомления можно отправлять в любое приложение, которое создается в PowerApps. В будущем мы планируем добавить больше типов уведомлений.

![Пример того, как выглядит push-уведомление](./media/add-notifications/pic1-notification-screenshot.png)

Добавьте в приложение функцию push-уведомлений, если:

* вам нужно оперативно информировать пользователей;
* пользователи должны выполнять важные задачи с помощью приложения в предварительно загруженном контексте;
* вам нужно привлечь пользователей на определенный срок или требуется, чтобы пользователи вошли в приложение в определенном контексте.

> [!NOTE]
> Чтобы пользователи могли получать push-уведомления, каждому из них нужно один раз открыть приложение в PowerApps Mobile или получить приложение из AppSource в [Dynamics 365](https://home.dynamics.com/).

## <a name="before-you-start"></a>Перед началом работы
Добавьте подключение PowerApps Notification в приложение, для которого у вас есть разрешения **участника**. Если у вас еще нет приложения, вы можете быстро [создать его из шаблона](get-started-test-drive.md). Вы получите необходимые разрешения по умолчанию. В этих руководствах используется приложение на основе шаблона Case Management.

## <a name="send-a-notification-from-a-flow"></a>Отправка push-уведомления из последовательности
> [!NOTE]
> Если активировать push-уведомление из последовательности, за один раз сейчас вы сможете отправить уведомление только одному пользователю или группе безопасности.

1. В [Microsoft Flow](https://flow.microsoft.com) создайте триггер, который определяет время отправки уведомления.

    Например, можно отправлять уведомление при добавлении записи в сущность **Case** в службе Common Data Service.

    ![Снимок экрана с созданием последовательности с триггером в службе Common Data Service](./media/add-notifications/pic4-step1-flowupdated.png)
2. Создайте действие для последовательности с помощью соединителя **PowerApps Notification** и введите **идентификатор приложения** для приложения, в которое требуется отправлять уведомления.

    Вы также можете переименовать подключение в соответствии со своим сценарием.

    ![Снимок экрана с созданием подключения к PowerApps для получения push-уведомлений](./media/add-notifications/pic5-step2-create-connection.jpg)
3. (Необязательно.) Передайте параметры в приложение, когда оно откроется (при касании push-уведомления).

    В нашем примере мы передаем выбранному контакту поля **Case ID** (Идентификатор обращения) и **Initial Owner** (Первоначальный владелец).

    ![Снимок экрана с передачей необязательных параметров в push-уведомление](./media/add-notifications/pic6-step3-configure-notif.jpg)

## <a name="send-a-notification-from-an-app"></a>Отправка уведомления из приложения
Вы можете отправлять push-уведомления из одного приложения в другое или то же приложение.

1. В [PowerApps](https://web.powerapps.com/) перейдите к приложению, в которое необходимо отправить push-уведомления.
2. На вкладке **Подробности** скопируйте **идентификатор приложения**.

    ![Получение идентификатора приложения](./media/add-notifications/grab-id.png)
3. На вкладке **Подключения** создайте подключение к соединителю PowerApps Notification и вставьте скопированный идентификатор приложения.

    ![Создание подключения](./media/add-notifications/create-connection.png)
4. Добавьте подключение к приложению триггера.

    В нашем примере используется приложение триггера. Пользователь, который переназначает задание, также активирует отправку push-уведомления новому владельцу обращения.

    ![Добавление подключения](./media/add-notifications/add-connection.png)
5. Из подключения push-уведомления вызовите метод **SendPushNotification**.

    В нашем примере это уведомление активируется с помощью свойства **OnSuccess** в форме.

    ![Формула PowerApps](./media/add-notifications/powerapps-function.png)

## <a name="load-a-specific-page-and-context-when-a-user-taps-the-notification"></a>Загрузка определенной страницы и контекста при касании уведомления
### <a name="pass-parameters"></a>Передача параметров
Вы можете использовать push-уведомления для передачи определенных параметров в приложение. Например, чтобы считать значение **CaseID**, используйте *Param("CaseID")*. Чтобы быстро определять этот параметр, добавьте элемент управления **Метка** в приложение. Для свойства **Text** этого элемента управления задайте значение **Param("CaseID")**. Если приложение открывается из списка **Все приложения**, значение будет пустым. Если же открыть приложение из другого расположения на устройстве, указывается значение **CaseID**.

### <a name="set-the-start-page"></a>Настройка начальной страницы
Можно настроить, чтобы при открытии приложения открывалась страница, например, **Сведения об обращении**.

1. Добавьте элемент управления **Таймер** и задайте для свойства **OnTimerEnd** следующую формулу в качестве значения:
   <br>**Navigate(EditCase, ScreenTransition.None)**.
2. (Необязательно.) Чтобы скрыть элемент управления **Таймер**, задайте для его свойства **Visible** значение **false**.
3. Для свойства экрана **OnVisible** установите значение **Timer.Start()**.

> [!TIP]
> Мы рекомендуем создать в приложении уникальную первую страницу для уведомления:
> 
> 1. Создайте пустую страницу, которая еще не открывалась в приложении. Добавьте элемент управления **Текстовое поле** и задайте для него значение **timer.Duration**.
> 2. Создавая приложение, установите для таймера ненулевое значение. Когда приложение будет готово к публикации, установите значение **0**, чтобы сразу же активировать таймер.

## <a name="syntax"></a>Синтаксис

| Имя | Описание |
| --- | --- |
| SendPushNotification |Отправляет push-уведомление в приложение, указанное в настройках подключения push-уведомления. |

### <a name="parameters"></a>Параметры

| Имя | Тип | Описание |
| --- | --- | --- |
| recipients |Обязательный массив строк |Представляет собой список: <ul> <li>адресов электронной почты пользователей или групп безопасности;</li> <li>идентификаторов объектов для пользователей или групп безопасности в Azure Active Directory.</li></ul> |
| message |Строка, обязательный параметр |Текст сообщения для push-уведомления. |
| openApp |Логический, необязательный параметр |Настройка открытия приложения, когда пользователь касается push-уведомления. |
| params |Параметры, необязательный параметр |Параметры типа "ключ-значение" для передачи с уведомлением. Они могут дополнительно обрабатываться в приложении для открытия определенной страницы и загрузки необходимого состояния. |

### <a name="sample-formulas"></a>Примеры формул
Отправьте базовое уведомление.

```
PowerAppsNotification.SendPushNotification(
{
  recipients: [""f60ccf6f-7579-4f92-967c-2920473c966b", 72f988bf-86f1-41af-91ab-2d7cd011db47],
  message: "A new case was assigned to you."
 }
)
```

Отправьте уведомление, которое открывает приложение и передает определенные параметры.

```
PowerAppsNotification.SendPushNotification(
{
  recipients:["email1@contoso.com", "email2@contoso.com"],
  message:"message in the notif toast",
  params:Table({key:"notificationKey", value:"The value for notificationKey"}),
  openApp:true
 }
)
```

## <a name="known-limitations"></a>Известные ограничения
* Сейчас уведомления не отображаются в PowerApps Mobile для Windows Phone.
* На этом этапе push-уведомления не поддерживаются, если пользователи запускают приложение только в веб-браузере.
* В уведомлениях отображается стандартный значок PowerApps вместо значка определенного приложения.
* С помощью Microsoft Flow вы можете за один раз отправить уведомление только одному получателю.

Справочные сведения см. в [справочнике по соединителю PowerApps Notification](https://docs.microsoft.com/connectors/powerappsnotification/).

